#include <stdio.h>
#include <stdlib.h>

struct Term{
    int coeff,x,y,z;
    struct Term* next;
};

struct Term* createTerm(int c,int x,int y,int z){
    struct Term* t=malloc(sizeof(struct Term));
    t->coeff=c; t->x=x; t->y=y; t->z=z;
    t->next=NULL;
    return t;
}

void insertTerm(struct Term** head,int c,int x,int y,int z){
    struct Term* t=createTerm(c,x,y,z);
    if(!*head){ *head=t; t->next=t; return; }
    struct Term* cur=*head;
    while(cur->next!=*head) cur=cur->next;
    cur->next=t; t->next=*head;
}

void display(struct Term* head){
    if(!head) return;
    struct Term* cur=head;
    do{
        printf("%dx^%dy^%dz^%d",cur->coeff,cur->x,cur->y,cur->z);
        cur=cur->next;
        if(cur!=head) printf(" + ");
    }while(cur!=head);
    printf("\n");
}

struct Term* add(struct Term* p1,struct Term* p2){
    struct Term *r=NULL,*a=p1,*b=p2;
    do{
        insertTerm(&r,a->coeff+b->coeff,a->x,a->y,a->z);
        a=a->next; b=b->next;
    }while(a!=p1 && b!=p2);
    return r;
}

void freeList(struct Term** head){
    if(!*head) return;
    struct Term *cur=(*head)->next,*t;
    while(cur!=*head){
        t=cur; cur=cur->next; free(t);
    }
    free(*head); *head=NULL;
}

int main(){
    struct Term *p1=NULL,*p2=NULL,*sum;

    insertTerm(&p1,6,2,2,1);
    insertTerm(&p1,-4,0,1,5);
    insertTerm(&p1,3,3,1,1);
    insertTerm(&p1,2,1,5,1);
    insertTerm(&p1,-2,1,1,3);
    display(p1);

    insertTerm(&p2,2,2,2,1);
    insertTerm(&p2,5,0,1,5);
    insertTerm(&p2,-1,3,1,1);
    display(p2);

    sum=add(p1,p2);
    display(sum);

    freeList(&p1); freeList(&p2); freeList(&sum);
    return 0;
}